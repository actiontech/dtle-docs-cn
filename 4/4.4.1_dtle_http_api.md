# dtle 3.x HTTP API 说明

dtle 3.x 根据业务功能提供了一套HTTP API（开启方式见["节点配置"](./4.1_node_configuration.md)，api_addr），可与dtle UI配套使用。  

本节API示例默认使用swagger UI调用。

## 通过swagger UI查看接口文档
访问```http://{dtle ip}:8190/swagger/index.html```通过swagger UI查看接口文档，打开界面如下：  

![](images/4.4.1_swagger_ui.png)

## swagger UI 登录

## 通过swagger UI调用API
除了使用curl命令外，还可以通过swagger UI界面调用API，具体步骤如下：

1 点击"Try it out"，进入调试模式

![](images/4.4.1_try_it_out.png)

2 填写请求参数后点击"Execute"调用API

![](images/4.4.1_execute.png)

3 查看响应：

![](images/4.4.1_response.png)

4 由于用户校验功能限制，大多数接口调用需要在header中携带登录成功返回的token，在swagger页面可点击swagger页面顶部的Authorize按钮，将token填入Value的文本框中，swagger页面中其他接口即可正常使用
  
![](images/4.4.1_login.png)
  
## 获取验证码

#### API: `GET /v2/login/captcha`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| captcha_type          | 是             | String       | "default"        | 获取校验码类型
#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| id    | String     | 校验码id
| data_scheme    | String      | Data URI scheme，复制到浏览器的地址栏，获取校验码

#### 样例
response:
```
{
    "id":"BCOUfuFCdR2m6DRmCov8",
    "data_scheme":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAABQCAMAAAAQlwhOAAAA81BMVEUAAAAZR2oTQWQ8ao0eTG82ZIcALlF3pcgWRGcbSWwiUHMGNFdNe56HtdgxX4IBL1I1Y4ZDcZRgjrErWXwXRWgmVHdNe54+bI8qWHtEcpV1o8YfTXCArtFejK9Bb5JunL+DsdRhj7JikLNlk7ZIdpksWn1+rM+Ittk6aIsOPF9wnsFEcpUtW35Mep06aIsGNFcJN1pXhagzYYQVQ2aDsdQ0YoVUgqUFM1YgTnFRf6J2pMeJt9pJd5oqWHt9q84VQ2Z9q847aYxdi65vncBejK8INll8qs16qMuFs9ZwnsFXhag1Y4ZMep2GtNcbSWxLeZx5p8oCljxgAAAAAXRSTlMAQObYZgAABgRJREFUeJzsXFlL60AUnlMRxeXBB1FciCIFFbUuoJVWqqgvhuv//zmXpMnM2SaZrLXe+wk2mfV8+c6cOUm05j8Wi88OxrxsdbST8KY35U0+P9tnfHnZJuOTk2DGNzchjNXS50o2cbSs8E5w0wC+Op6fCxgP645aEzs74Yxro4jvsHfGPc/H0Tff/+gHp4s2oAM8FtSdnv4+xo+PhYx7tKQvFPH95QD7828AHIL7HHZqUbeoQdccHi4p49SRaxBeFoU5pYzn71zBcylZ2ZzubwMYGGheW9mPVbxnnwda5V1+8Np0mnAkpAaDgSAcoG7I/eb7+5zxwYHC+O4uY/z6WsK4iaMBGyhl7BZr+AxBTxRaUVhYF4gs+AAusL6cHW/gKUpQ+4lCRQDaLKp0M45bPhAOwenxxsaGq/ohAKSwtMq7iaA+thcdACncSrhyuFPK4sC+1AE5L28WCERgsI155/yo1c3IxiaEOA5mbGCWGAbKzgnkB1cAETjrpTSyh2i85migcGLUbDazZhGDgAJVONMBfP5KFjcZboG5x5zizJ1i24HpSIITctf8TEskjVvZLqAtMoBp2mmVVOScIZxkn6nOTGqwPjDnW+u2sG2oTqxW0iwiMzt9T8EcFS1oMO6Irvme6CnQwhSuU89y8lhhADjNm1CxwTpAdrrIOyUeQITf8mTYs1Ml42RPHpGT43F4aGhi9VX9rjzVYE4sFHZ6snGSklO8P9MIx1dDfYsTvle1GeuWozQCaBWKPGovVJ3+jmzeqs1QG1d07ipdZTLJMmM3rFuXykbqSOKtJ4oiGaRa2YapbTX7Ict5JVq8vm4G+N1SrrBk3Exh5QKGj1eksEscAIUi0J2SKfw1cH7NnLop3zMxCHj9WryJLFE423sM3lGNugyBhqavwWBgs+ysQnGcikiHOzs70/zLaKMq75pLFcZ0HVF9EduTOP4a4JieTePO6/Gdf5ypdaCGr0KFHygnW+vbil1pZPili2kcwzZVW3KOLNwW72hqNq8OlDV6eHjIS1CdcocLXM8oinxeTlt6A0CAjXB7e1va0BP/I3e461cY1LsadRFHssigkE1tgqNsWQuMClikCpdDHTkVZI7d3V1tDeerTzIOXcSuQCQdR0dHuZPQAUYjwRgNEegU6sgehd0cq8ZFPi2F9GxM/NrJB4Np9DqyIZWNMuITWU8rJrnC+hU2Zlamp6urqyjB8OSQ04L9zBWI+00Uw0aAygBHh/nhJDCir6ysKJbwnhNslGs5b7zKjBY07s10yhmLSWyMJ7dNVq7RaKRdI3s4mUwC3Tjne8zKcffJJGds8K2CWC66xPf392ZqlBWr9bQpCQ8JI9TQo7CKdU/58fExmx1bP3FVIjAT0WVwMonCekzGfO0zAkyoRLMQD15f9zIWlhqu2Q29sqb4iQ8p0VYsiU4AeI16nvLXgY+vBDAjIH15RVe4UFgSHrpgxC8NSdFwRq6FkZ6gKowsNfymP2aRaDgc2p0Ya5orr7xhswrborWO2PlAaGLzpA5xHNMrYIZkcdAAjO+HLfbF2l1bq8ZYz8FqwxmuOV5MF6dwf2BPnEV42t/fF1NW5CtzsGZArw8VxsR+xf8FWT6E5FsVLfPFgcWTJLNoR2u4tIt8dZTjPvvc8NRjhWWl+MFVnOyPQJIaJchfx0vIt/mk1u+vKMUIt6f7P7HxKjxFxwW5QdGLsOqi+v7EZlx5pMqYTqe0wGu9n3ANePiOLeM/zefwYBrcUlnBbcPx/VPKuLtLshCU8y2/JG0h6muiYvTHN/ohjHvDv8Y3EDOl7EFr+Na9LX3A/iEUQv6kn+DtTWN83ooRm7LopZWBNTRS+Py8Dcabm4Lxy0t3jBthCRUuxtOC5l0Unp7CGIe8TVoOEL7XehswAe8L28NWu8PxR8Zm2x5dX6uMk5uU3viOzdZWq4zxS4EU29uIsd6nx0cJ4+G4R4W7x0dZg/6/dqBTfHyUM84P9jq3pg+U8rXY21smxhfp72ZfidI9329RUvd/ly4uLsq+EuUH4PubMw777zQNbSjcPZor/DcAAP//7W9H1fSQTvcAAAAASUVORK5CYII=",
    "message":"ok"
}
```

## 用户登录

#### API: `POST /v2/login`

#### 请求参数说明

| 参数名         | 必填?           | 类型        | 默认值         | 说明            |
| ------------- | -------------- | ---------- | ---------- | ------------- |
| username         | 是             | String      | ""        | 用户名 |
| tenant          | 是             | String      | ""        | 租户名 |    
| password         | 是             | String      | ""        | 密码 | 
| captcha_id        | 是             | String      | ""        | 验证码id |
| captcha         | 是             | String      | ""        | 验证码 |  

#### 响应参数说明

 token 接口调用时候需要在header中携带  

#### 样例
params：  
```
{
     "username":"admin",
     "password":"qrzOYInKluhHI2SkEQssfrNCB+ee9rLGzLEGZMXANPU4npTlFmS/hb0qs3ahn6S4tG/RvoUDwsTdUj77Lbrt1hQ+lJT3JVnXCoj4bxQG2W2W8CAzDLMj9Dmzp9iOt7iEPCgonpwOuaMYwjXNnUN05IvI3hcCIaR02EoW1NqR3Ow=",
     "captcha":"00036",
     "tenant":"platform",
     "captcha_id":"BCOUfuFCdR2m6DRmCov8"
 }
```

response:
```
{
    "message":"ok",
    "data":{
        "token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MzEwMDQ5NDQsImdyb3VwIjoicGxhdGZvcm0iLCJuYW1lIjoiYWRtaW4ifQ.iZYXNXXZqY5FVmexPY3yD2ZiO4xjeOLmdTq6pxvU4sE"
    }
}
```

## 创建 一个迁移作业

#### API: `POST /v2/job/migration/create`
创建的job类型为`migration`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| migration_job_config  | 是             | JSON Object       | ""        | 创建job所需的配置 |  

`migration_job_config`字段说明：  

| 参数名                       | 必填?   | 类型        | 默认值         | 说明          |                                                                                                                                                                                                                                     
| --------------------------- | ------ | ------------ | ----------- | ------------- |                                                                                                                                                                                                                                   
| job_id                      | 是       | String       | ""       | 创建job时会指定job id为 `"job_id-{job类型}"` |
| failover                    | 否       | bool       | true        | 是否支持故障转移。设置failover=false时，该job的所有task不启用故障转移，要求同时填写task的```node_id```以指定每个task运行的节点，如果运行节点发生故障，不会将task转移到其它节点运行；设置failover=true时，启用故障转移。|
| task_step_name              | 否       | String       | ""        | 任务步骤名。表示该任务为全量复制 job_stage_full，增量复制 job_stage_incr，增量加全量 all|
| is_mysql_password_encrypted | 否       | bool       | false        | MySQL密码是否经过加密。设置is_mysql_password_encrypted=true时，认为所填写的```mysql_password```经过两次加密（先是rsa/none/pkcs1 padding 加密，再做base64编码），要求将rsa密钥以pem格式保存在文件中，再将文件绝对路径配置到nomad.hcl的```rsa_private_key_path```参数（配置方法见["节点配置"](./4.1_node_configuration.md)）；设置is_mysql_password_encrypted=false时，```mysql_password```填写明文密码。|
| dest_task                   | 是       | JSON Object | ""      | 目标端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| src_task                    | 是       | JSON Object | ""      | 源端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| retry                      | 否       | Int       | 2            | 重试次数。参数说明参考restart字段 ["作业配置"](./4.3_job_configuration.md)。|
| reverse                    | 否       | bool       | true      | 该任务是否为反向复制标志。设置reverse=true时，同时配合src_task字段中的task_name和wait_on_job，表示该任务是task_name的反向复制任务，需要再次调用启动反向任务接口才会运行当前任务并且停止原任务（task_name）|
#### 响应参数说明

返回请求的job配置

#### 样例
params：  
`migration_job_config`: 
```
{
    "job_id":"demo",
    "src_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33061,
            "mysql_user":"root",
            "mysql_password":"tOVPvMXeG3ab9JX66sNXc/X4E+3fOTA4kWCvHrw7PGxUrlkMx+naHUQFDqPv/WKym6BhjZ4kh5GNOsTk/rU4vc+LDn4eLauydTlLkJ0ZUHF5YF3OIjFO/4w3UDHOroUbEtizO/cXljmEu+J1jovQtsqQGE8mVfqq9iQsb2pB1EA="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "gtid":"",
        "drop_table_if_exists":true,
        "binlog_relay":false,
        "repl_chan_buffer_size":120,
        "group_max_size":1,
        "group_timeout":100,
        "chunk_size":2000,
        "skip_create_db_table":false,
        "task_name":"src",
        "replicate_do_db":[

        ]
    },
    "is_mysql_password_encrypted":true,
    "dest_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33062,
            "mysql_user":"root",
            "mysql_password":"pytsz1GOSL7jmW+U2PLJSenEPCZGFJqP0PP1DDe/r+D8n8n6pXtCPu8FlQpCyMjdpWGV30Hv3RLmIH4MziLKeKJ/Lz/ZuoDVvAQEL/Hym7TSmriK8WJYQQKqgUKjmQLuBG7zQZo8nwD/+i0SBDvMC+i0vp9InVw1U7zK/pAclhw="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "use_my_sql_dependency":true,
        "dependency_history_size":2500,
        "parallel_workers":1,
        "task_name":"dest"
    },
    "task_step_name":"job_stage_full",
    "failover":true,
    "retry":2
}
```

response:
```
{
    "job":{
        "job_id":"demo-migration",
        "task_step_name":"job_stage_full",
        "reverse":false,
        "failover":true,
        "is_mysql_password_encrypted":true,
        "src_task":{
            "task_name":"src",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "gtid":"",
            "group_max_size":1,
            "chunk_size":2000,
            "drop_table_if_exists":true,
            "skip_create_db_table":false,
            "repl_chan_buffer_size":120,
            "replicate_do_db":[

            ],
            "replicate_ignore_db":null,
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33061,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "binlog_relay":false,
            "group_timeout":100,
            "wait_on_job":"",
            "auto_gtid":false
        },
        "dest_task":{
            "task_name":"dest",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "parallel_workers":1,
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33062,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "use_my_sql_dependency":true,
            "dependency_history_size":2500
        },
        "retry":2
    },
    "eval_create_index":4798,
    "job_modify_index":4798,
    "message":"ok"
}
```

## 更新 一个迁移作业

#### API: `POST /v2/job/migration/update`
更新的job类型为`migration`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| migration_job_config  | 是             | JSON Object       | ""        | 创建job所需的配置 |  

`migration_job_config`字段说明：  

| 参数名                       | 必填?   | 类型        | 默认值         | 说明          |                                                                                                                                                                                                                                     
| --------------------------- | ------ | ------------ | ----------- | ------------- |                                                                                                                                                                                                                                   
| job_id                      | 是       | String       | ""       | 创建job时会指定job id为 `"job_id-{job类型}"` |
| failover                    | 否       | bool       | true        | 是否支持故障转移。设置failover=false时，该job的所有task不启用故障转移，要求同时填写task的```node_id```以指定每个task运行的节点，如果运行节点发生故障，不会将task转移到其它节点运行；设置failover=true时，启用故障转移。|
| task_step_name              | 否       | String       | ""        | 任务步骤名。表示该任务为全量复制 job_stage_full，增量复制 job_stage_incr，增量加全量 all|
| is_mysql_password_encrypted | 否       | bool       | false        | MySQL密码是否经过加密。设置is_mysql_password_encrypted=true时，认为所填写的```mysql_password```经过两次加密（先是rsa/none/pkcs1 padding 加密，再做base64编码），要求将rsa密钥以pem格式保存在文件中，再将文件绝对路径配置到nomad.hcl的```rsa_private_key_path```参数（配置方法见["节点配置"](./4.1_node_configuration.md)）；设置is_mysql_password_encrypted=false时，```mysql_password```填写明文密码。|
| dest_task                   | 是       | JSON Object | ""      | 目标端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| src_task                    | 是       | JSON Object | ""      | 源端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| retry                      | 否       | Int       | 2            | 重试次数。参数说明参考restart字段 ["作业配置"](./4.3_job_configuration.md)。|
| reverse                    | 否       | bool       | true      | 该任务是否为反向复制标志。设置reverse=true时，同时配合src_task字段中的task_name和wait_on_job，表示该任务是task_name的反向复制任务，需要再次调用启动反向任务接口才会运行当前任务并且停止原任务（task_name）|
#### 响应参数说明

返回请求的job配置

#### 样例
params：  
`migration_job_config`: 
```
{
    "job_id":"demo-migration",
    "src_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33061,
            "mysql_user":"root",
            "mysql_password":"PCvXTB1/kgoxBgJUArJLsdeWo04FgFDi+xeAAgvo+yoz7KUwmHFGE51WRWGrpUcWXgSQGnwuyuTzEwgQv6/ZDAkZZfO+T/F/67eiWT7QhZatn6XCiX0ElpC3rPi2YkOpsyL7pN0d52IfcdrkBrdRh3vBe3uW9fYEAfSbHDET26Q="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "gtid":"",
        "replicate_ignore_db":[

        ],
        "drop_table_if_exists":true,
        "binlog_relay":false,
        "repl_chan_buffer_size":120,
        "group_max_size":1,
        "group_timeout":100,
        "chunk_size":2000,
        "skip_create_db_table":false,
        "task_name":"src",
        "replicate_do_db":[
            {
                "table_schema":"demo",
                "tables":[
                    {
                        "table_name":"demo_tbl"
                    }
                ]
            }
        ]
    },
    "is_mysql_password_encrypted":true,
    "dest_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33062,
            "mysql_user":"root",
            "mysql_password":"DRNmjvZs71Kv16acHXAS9SSqS5slxLQ8j48SU0lfH48QBVxi4tTAg2hp+gofR+9NRT/HaZ5AraMmSpW9j0o379QymUaIHKXK25PB5goj8OBzg1NZD3sm865RU+VQFeEf87B2eyNqGBmOczS1s2ws2JitEGhiothaCRRHbo52Lp4="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "use_my_sql_dependency":true,
        "dependency_history_size":2500,
        "parallel_workers":1,
        "task_name":"dest"
    },
    "task_step_name":"job_stage_full",
    "failover":true,
    "retry":2
}
```

response:
```
{
    "job":{
        "job_id":"demo-migration",
        "task_step_name":"job_stage_full",
        "reverse":false,
        "failover":true,
        "is_mysql_password_encrypted":true,
        "src_task":{
            "task_name":"src",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "gtid":"",
            "group_max_size":1,
            "chunk_size":2000,
            "drop_table_if_exists":true,
            "skip_create_db_table":false,
            "repl_chan_buffer_size":120,
            "replicate_do_db":[
                {
                    "table_schema":"demo",
                    "table_schema_regex":"",
                    "table_schema_rename":"",
                    "tables":[
                        {
                            "table_name":"demo_tbl",
                            "table_regex":"",
                            "table_rename":"",
                            "column_map_from":null,
                            "where":""
                        }
                    ]
                }
            ],
            "replicate_ignore_db":[

            ],
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33061,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "binlog_relay":false,
            "group_timeout":100,
            "wait_on_job":"",
            "auto_gtid":false
        },
        "dest_task":{
            "task_name":"dest",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "parallel_workers":1,
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33062,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "use_my_sql_dependency":true,
            "dependency_history_size":2500
        },
        "retry":2
    },
    "eval_create_index":4816,
    "job_modify_index":4816,
    "message":"ok"
}
```

## 创建 一个同步作业

#### API: `POST /v2/job/sync/create`
创建的job类型为`sync`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| sync_job_config  | 是             | JSON Object       | ""        | 创建job所需的配置 |  

`sync_job_config`字段说明：

| 参数名                       | 必填?   | 类型        | 默认值         | 说明          |                                                                                                                                                                                                                                     
| --------------------------- | ------ | ------------ | ----------- | ------------- |                                                                                                                                                                                                                                   
| job_id                      | 是       | String       | ""       | 创建job时会指定job id为 `"job_id-{job类型}"` |
| failover                    | 否       | bool       | true        | 是否支持故障转移。设置failover=false时，该job的所有task不启用故障转移，要求同时填写task的```node_id```以指定每个task运行的节点，如果运行节点发生故障，不会将task转移到其它节点运行；设置failover=true时，启用故障转移。|
| task_step_name              | 否       | String       |""        | 任务步骤名。表示该任务为全量复制 job_stage_full，增量复制 job_stage_incr，增量加全量 all|
| is_mysql_password_encrypted | 否       | bool       | false        | MySQL密码是否经过加密。设置is_mysql_password_encrypted=true时，认为所填写的```mysql_password```经过两次加密（先是rsa/none/pkcs1 padding 加密，再做base64编码），要求将rsa密钥以pem格式保存在文件中，再将文件绝对路径配置到nomad.hcl的```rsa_private_key_path```参数（配置方法见["节点配置"](./4.1_node_configuration.md)）；设置is_mysql_password_encrypted=false时，```mysql_password```填写明文密码。|
| dest_task                   | 是       | JSON Object | ""      | 目标端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| src_task                    | 是        | JSON Object | ""      | 源端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| retry                      | 否       | Int       | 2            | 重试次数。参数说明参考restart字段 ["作业配置"](./4.3_job_configuration.md)。|
| reverse                    | 否       | bool       | true      | 该任务是否为反向复制标志。设置reverse=true时，同时配合src_task字段中的task_name和wait_on_job，表示该任务是task_name的反向复制任务，需要再次调用启动反向任务接口才会运行当前任务并且停止原任务（task_name）|

#### 响应参数说明

返回请求的job配置

#### 样例
params：  
`sync_job_config`:
```
{
    "job_id":"demo",
    "src_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33061,
            "mysql_user":"root",
            "mysql_password":"OIjXGJYydZHFNN3TyPBAMFUfsfcIbXBW3sBKjf2c0wvgXrmqI44xldxr6e5vqzBUwLpEMp+fNh/h80xwWbSJm4wjiJjQPSwNaj5lN/6+yDMM+LqiuJC0WqOG/L2Unk4AsfEvHNxeZO0sXVHDsM+mVIJnS8D0dnYzZsF874m3nTs="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "gtid":"",
        "drop_table_if_exists":true,
        "binlog_relay":false,
        "repl_chan_buffer_size":120,
        "group_max_size":1,
        "group_timeout":100,
        "chunk_size":2000,
        "skip_create_db_table":false,
        "task_name":"src",
        "replicate_do_db":[

        ]
    },
    "is_mysql_password_encrypted":true,
    "dest_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33062,
            "mysql_user":"root",
            "mysql_password":"Kql8Oq2X0T0MS8SMBkOKsdt0CU2igpeVSLykQaoJL6NAW8L1hVRFUETRKlF6kSEa33TTagjoQ6S8rKKLz4YWJnn69TV2RgOkDk98PNE6IFls4y0mm4BbtKOhKKSj6Pr7qcA7Y5OTBrc/Re2VTALL6fdCw+0Zfw9Mk+vtPuODUoQ="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "use_my_sql_dependency":true,
        "dependency_history_size":2500,
        "parallel_workers":1,
        "task_name":"dest"
    },
    "task_step_name":"job_stage_incr",
    "failover":true,
    "retry":2
}
```

response:
```
{
    "job":{
        "job_id":"demo-sync",
        "task_step_name":"job_stage_incr",
        "reverse":false,
        "failover":true,
        "is_mysql_password_encrypted":true,
        "src_task":{
            "task_name":"src",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "gtid":"",
            "group_max_size":1,
            "chunk_size":2000,
            "drop_table_if_exists":true,
            "skip_create_db_table":false,
            "repl_chan_buffer_size":120,
            "replicate_do_db":[

            ],
            "replicate_ignore_db":null,
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33061,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "binlog_relay":false,
            "group_timeout":100,
            "wait_on_job":"",
            "auto_gtid":false
        },
        "dest_task":{
            "task_name":"dest",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "parallel_workers":1,
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33062,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "use_my_sql_dependency":true,
            "dependency_history_size":2500
        },
        "retry":2
    },
    "eval_create_index":4967,
    "job_modify_index":4967,
    "message":"ok"
}
```

## 更新 一个同步作业

#### API: `POST /v2/job/sync/update`
更新的job类型为`sync`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| sync_job_config  | 是             | JSON Object       | ""        | 创建job所需的配置 |  

`sync_job_config`字段说明：

| 参数名                       | 必填?   | 类型        | 默认值         | 说明          |                                                                                                                                                                                                                                     
| --------------------------- | ------ | ------------ | ----------- | ------------- |                                                                                                                                                                                                                                   
| job_id                      | 是       | String       | ""       | 创建job时会指定job id为 `"job_id-{job类型}"` |
| failover                    | 否       | bool       | true        | 是否支持故障转移。设置failover=false时，该job的所有task不启用故障转移，要求同时填写task的```node_id```以指定每个task运行的节点，如果运行节点发生故障，不会将task转移到其它节点运行；设置failover=true时，启用故障转移。|
| task_step_name              | 否       | String       |""        | 任务步骤名。表示该任务为全量复制 job_stage_full，增量复制 job_stage_incr，增量加全量 all|
| is_mysql_password_encrypted | 否       | bool       | false        | MySQL密码是否经过加密。设置is_mysql_password_encrypted=true时，认为所填写的```mysql_password```经过两次加密（先是rsa/none/pkcs1 padding 加密，再做base64编码），要求将rsa密钥以pem格式保存在文件中，再将文件绝对路径配置到nomad.hcl的```rsa_private_key_path```参数（配置方法见["节点配置"](./4.1_node_configuration.md)）；设置is_mysql_password_encrypted=false时，```mysql_password```填写明文密码。|
| dest_task                   | 是       | JSON Object | ""      | 目标端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| src_task                    | 是        | JSON Object | ""      | 源端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| retry                      | 否       | Int       | 2            | 重试次数。参数说明参考restart字段 ["作业配置"](./4.3_job_configuration.md)。|
| reverse                    | 否       | bool       | true      | 该任务是否为反向复制标志。设置reverse=true时，同时配合src_task字段中的task_name和wait_on_job，表示该任务是task_name的反向复制任务，需要再次调用启动反向任务接口才会运行当前任务并且停止原任务（task_name）|

#### 响应参数说明

返回请求的job配置

#### 样例
params：  
`sync_job_config`:
```
{
    "job_id":"demo-sync",
    "src_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33061,
            "mysql_user":"root",
            "mysql_password":"H66OYCpS4+ElyGFpUIpUp80v1dKF5aCkOEPfCKUrFpC3xddB0fDsENgI8A5275ctsOn01O4J4UMw1OZ3AQlY6uwzeMq9T+ekx31v5D2/RjBe557GBtrS8ijKA8pAFfOhUxug/TB0qzBzRekw4KWEL9PTNKRfX0I54J2IsFSXp48="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "gtid":"",
        "replicate_ignore_db":[

        ],
        "drop_table_if_exists":true,
        "binlog_relay":false,
        "repl_chan_buffer_size":120,
        "group_max_size":1,
        "group_timeout":100,
        "chunk_size":2000,
        "skip_create_db_table":false,
        "task_name":"src",
        "replicate_do_db":[
            {
                "table_schema":"demo",
                "tables":[
                    {
                        "table_name":"demo_tbl"
                    }
                ]
            }
        ]
    },
    "is_mysql_password_encrypted":true,
    "dest_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33062,
            "mysql_user":"root",
            "mysql_password":"yvgvYc7vYJkhrMMPmfdfeAzcZZttxB7RwXQiQJpEdAGtfhrqB/IkILYrESHeVbC7Narf4iKImWpPKwL7baPNp+bNTl1Hw/ZRf5yZKCw6uQeynpwIXhL92RWpDtB9KBtaUBrUzwJmu8If50c2U+S7S8usfKE/6Y8QM7OaI0wXjHI="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "use_my_sql_dependency":true,
        "dependency_history_size":2500,
        "parallel_workers":1,
        "task_name":"dest"
    },
    "task_step_name":"job_stage_incr",
    "failover":true,
    "retry":2
}
```

response:
```
{
    "job":{
        "job_id":"demo-sync",
        "task_step_name":"job_stage_incr",
        "reverse":false,
        "failover":true,
        "is_mysql_password_encrypted":true,
        "src_task":{
            "task_name":"src",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "gtid":"",
            "group_max_size":1,
            "chunk_size":2000,
            "drop_table_if_exists":true,
            "skip_create_db_table":false,
            "repl_chan_buffer_size":120,
            "replicate_do_db":[
                {
                    "table_schema":"demo",
                    "table_schema_regex":"",
                    "table_schema_rename":"",
                    "tables":[
                        {
                            "table_name":"demo_tbl",
                            "table_regex":"",
                            "table_rename":"",
                            "column_map_from":null,
                            "where":""
                        }
                    ]
                }
            ],
            "replicate_ignore_db":[

            ],
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33061,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "binlog_relay":false,
            "group_timeout":100,
            "wait_on_job":"",
            "auto_gtid":false
        },
        "dest_task":{
            "task_name":"dest",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "parallel_workers":1,
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33062,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "use_my_sql_dependency":true,
            "dependency_history_size":2500
        },
        "retry":2
    },
    "eval_create_index":4979,
    "job_modify_index":4979,
    "message":"ok"
}
```

## 创建 一个订阅作业

#### API: `POST /v2/job/subscription/create`
创建的job类型为`subscription`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| subscription_job_config  | 是             | JSON Object       | ""        | 创建job所需的配置 |  

`subscription_job_config`字段说明：

| 参数名                       | 必填?   | 类型        | 默认值         | 说明          |                                                                                                                                                                                                                                     
| --------------------------- | ------ | ------------ | ----------- | ------------- |                                                                                                                                                                                                                                   
| job_id                      | 是       | String       | ""       | 创建job时会指定job id为 `"job_id-{job类型}"` |
| task_step_name              | 否       | String       |""        | 任务步骤名。表示该任务为全量复制 job_stage_full，增量复制 job_stage_incr，增量加全量 all|
| failover                    | 否       | bool       | true        | 是否支持故障转移。设置failover=false时，该job的所有task不启用故障转移，要求同时填写task的```node_id```以指定每个task运行的节点，如果运行节点发生故障，不会将task转移到其它节点运行；设置failover=true时，启用故障转移。|
| is_mysql_password_encrypted | 否       | bool       | false        | MySQL密码是否经过加密。设置is_mysql_password_encrypted=true时，认为所填写的```mysql_password```经过两次加密（先是rsa/none/pkcs1 padding 加密，再做base64编码），要求将rsa密钥以pem格式保存在文件中，再将文件绝对路径配置到nomad.hcl的```rsa_private_key_path```参数（配置方法见["节点配置"](./4.1_node_configuration.md)）；设置is_mysql_password_encrypted=false时，```mysql_password```填写明文密码。|
| dest_task                   | 是       | JSON Object | ""      | 目标端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| src_task                   | 是       | JSON Object | ""      | 源端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| retry                      | 否       | Int       | 2            | 重试次数。参数说明参考restart字段 ["作业配置"](./4.3_job_configuration.md)。|

#### 响应参数说明

返回请求的job配置

#### 样例
params：  
`subscription_job_config`:
```
{
    "job_id":"demo",
    "src_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33061,
            "mysql_user":"root",
            "mysql_password":"2ZT/i7938WoFXs+U8J4W6x7Qm6S6vH2hiq2q9TvM9seYCyedMy7ym1X2h9jTATFqEkGwP7/kV7rm3G9wgkSH9GVKqR/amHWsgT7gWQejqq4UO2HtTwx3dZfQAt/wT6CDNn8cM3VnXeiPr4K7MuEMiKb6VDJIcSHIhw8iKqTABzg="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "drop_table_if_exists":true,
        "binlog_relay":false,
        "repl_chan_buffer_size":120,
        "group_max_size":1,
        "group_timeout":100,
        "chunk_size":2000,
        "skip_create_db_table":false,
        "task_name":"src",
        "replicate_do_db":[

        ]
    },
    "is_mysql_password_encrypted":true,
    "dest_task":{
        "kafka_broker_addrs":[
            "10.186.63.18:9092"
        ],
        "kafka_topic":"demo",
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "parallel_workers":1,
        "task_name":"dest"
    },
    "task_step_name":"job_stage_full",
    "failover":true,
    "retry":2
}
```

response:
```
{
    "job":{
        "job_id":"demo-subscription",
        "task_step_name":"job_stage_full",
        "failover":true,
        "is_mysql_password_encrypted":true,
        "src_task":{
            "task_name":"src",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "gtid":"",
            "group_max_size":1,
            "chunk_size":2000,
            "drop_table_if_exists":true,
            "skip_create_db_table":false,
            "repl_chan_buffer_size":120,
            "replicate_do_db":[

            ],
            "replicate_ignore_db":null,
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33061,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "binlog_relay":false,
            "group_timeout":100,
            "wait_on_job":"",
            "auto_gtid":false
        },
        "dest_task":{
            "task_name":"dest",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "kafka_broker_addrs":[
                "10.186.63.18:9092"
            ],
            "kafka_topic":"demo",
            "message_group_max_size":1,
            "message_group_timeout":100
        },
        "retry":2
    },
    "eval_create_index":4997,
    "job_modify_index":4997,
    "message":"ok"
}
```

## 更新 一个订阅作业

#### API: `POST /v2/job/subscription/update`
更新的job类型为`subscription`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| subscription_job_config  | 是             | JSON Object       | ""        | 创建job所需的配置 |  

`subscription_job_config`字段说明：

| 参数名                       | 必填?   | 类型        | 默认值         | 说明          |                                                                                                                                                                                                                                     
| --------------------------- | ------ | ------------ | ----------- | ------------- |                                                                                                                                                                                                                                   
| job_id                      | 是       | String       | ""       | 创建job时会指定job id为 `"job_id-{job类型}"` |
| task_step_name              | 否       | String       |""        | 任务步骤名。表示该任务为全量复制 job_stage_full，增量复制 job_stage_incr，增量加全量 all|
| failover                    | 否       | bool       | true        | 是否支持故障转移。设置failover=false时，该job的所有task不启用故障转移，要求同时填写task的```node_id```以指定每个task运行的节点，如果运行节点发生故障，不会将task转移到其它节点运行；设置failover=true时，启用故障转移。|
| is_mysql_password_encrypted | 否       | bool       | false        | MySQL密码是否经过加密。设置is_mysql_password_encrypted=true时，认为所填写的```mysql_password```经过两次加密（先是rsa/none/pkcs1 padding 加密，再做base64编码），要求将rsa密钥以pem格式保存在文件中，再将文件绝对路径配置到nomad.hcl的```rsa_private_key_path```参数（配置方法见["节点配置"](./4.1_node_configuration.md)）；设置is_mysql_password_encrypted=false时，```mysql_password```填写明文密码。|
| dest_task                   | 是       | JSON Object | ""      | 目标端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| src_task                   | 是       | JSON Object | ""      | 源端配置，参数说明参考["作业配置"](./4.3_job_configuration.md) |
| retry                      | 否       | Int       | 2            | 重试次数。参数说明参考restart字段 ["作业配置"](./4.3_job_configuration.md)。|

#### 响应参数说明

返回请求的job配置

#### 样例
params：  
`subscription_job_config`:
```
{
    "job_id":"demo",
    "src_task":{
        "mysql_connection_config":{
            "mysql_host":"10.186.63.18",
            "mysql_port":33061,
            "mysql_user":"root",
            "mysql_password":"2ZT/i7938WoFXs+U8J4W6x7Qm6S6vH2hiq2q9TvM9seYCyedMy7ym1X2h9jTATFqEkGwP7/kV7rm3G9wgkSH9GVKqR/amHWsgT7gWQejqq4UO2HtTwx3dZfQAt/wT6CDNn8cM3VnXeiPr4K7MuEMiKb6VDJIcSHIhw8iKqTABzg="
        },
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "drop_table_if_exists":true,
        "binlog_relay":false,
        "repl_chan_buffer_size":120,
        "group_max_size":1,
        "group_timeout":100,
        "chunk_size":2000,
        "skip_create_db_table":false,
        "task_name":"src",
        "replicate_do_db":[

        ]
    },
    "is_mysql_password_encrypted":true,
    "dest_task":{
        "kafka_broker_addrs":[
            "10.186.63.18:9092"
        ],
        "kafka_topic":"demo",
        "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
        "parallel_workers":1,
        "task_name":"dest"
    },
    "task_step_name":"job_stage_full",
    "failover":true,
    "retry":2
}
```

response:
```
{
    "job":{
        "job_id":"demo-subscription",
        "task_step_name":"job_stage_full",
        "failover":true,
        "is_mysql_password_encrypted":true,
        "src_task":{
            "task_name":"src",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "gtid":"",
            "group_max_size":1,
            "chunk_size":2000,
            "drop_table_if_exists":true,
            "skip_create_db_table":false,
            "repl_chan_buffer_size":120,
            "replicate_do_db":[

            ],
            "replicate_ignore_db":null,
            "mysql_connection_config":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33061,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "binlog_relay":false,
            "group_timeout":100,
            "wait_on_job":"",
            "auto_gtid":false
        },
        "dest_task":{
            "task_name":"dest",
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "kafka_broker_addrs":[
                "10.186.63.18:9092"
            ],
            "kafka_topic":"demo",
            "message_group_max_size":1,
            "message_group_timeout":100
        },
        "retry":2
    },
    "eval_create_index":4997,
    "job_modify_index":4997,
    "message":"ok"
}
```

## 暂停一个迁移/同步/订阅作业

#### API: `POST /v2/job/job_type/pause`

#### 请求参数说明

| 参数名         | 必填?           | 类型        | 默认值         | 说明            |
| ------------- | -------------- | ---------- | ---------- | ------------- |
| job_id        | 是             | String      | ""        | 要暂停的job id |  

#### 响应参数说明
返回暂停结果

#### 样例
params：  
`job_id`: `demo-migration`

response:
```
{
  "message": "ok"
}
```

## 恢复一个迁移/同步/订阅作业

#### API: `POST /v2/job/job_type/resume`

#### 请求参数说明

| 参数名         | 必填?           | 类型        | 默认值         | 说明            |
| ------------- | -------------- | ---------- | ---------- | ------------- |
| job_id        | 是             | String      | ""        | 要恢复的job id |  

#### 响应参数说明
返回恢复结果

#### 样例
params：  
`job_id`: `demo-migration`

response:
```
{
  "message": "ok"
}
```

## 快速创建一个迁移/同步反向复制作业

#### API: `POST /v2/job/job_type/reverse`

#### 请求参数说明

| 参数名         | 必填?           | 类型        | 默认值         | 说明            |
| ------------- | -------------- | ---------- | ---------- | ------------- |
| job_id        | 是             | String      | ""        | 反向复制的源job id |
| reverse_config        | 否             | JSON      | ""        | 新任务的源端连接方式和目标端连接方式 |  

#### 响应参数说明
返回创建结果

#### 样例
params：  
```
{
    "job_id":"demo-migration",
    "reverse_config":{
        "src_user":"root",
        "src_pwd":"eI7vOGHFBeKiQraRyG3ELhBQV0PZZvW+yOTSbHTF9+8SJQ8Pr/EetkYm4WcG3Lx6KOhDBdiou2QCikIppovUgcTDaEovA7cpeU+FzvLIj2VccQMSodQuAb+/oniols+On5QYNPlhVRM5xCn0FH9Zm57dcSoCDMeOiCxj3APeMJA=",
        "dest_user":"root",
        "dst_pwd":"2a08zoW6VY3K5PQFgFfQdH7fOut0LnJT9prO4/bcYcAs2MlCS1JHANoul7yHPE7T4nKHQLVLn0xheax6I7MJudtzbewuVSx6zt0t7kWvCayB4yQwwzT/2wKlEqxc+u9U0n0VtnmIzuiklFxYPOiECZxzFFOt3Tl7EpioeBD6BvY=",
        "is_mysql_password_encrypted":true
    }
}
```

response:
```
{
  "message": "ok"
}
```

## 启动一个迁移/同步反向复制作业

#### API: `POST /v2/job/job_type/reverse_start`

#### 请求参数说明

| 参数名         | 必填?           | 类型        | 默认值         | 说明            |
| ------------- | -------------- | ---------- | ---------- | ------------- |
| job_id        | 是             | String      | ""        | 反向复制的源job id |

#### 响应参数说明
返回创建结果

#### 样例
params：  
`job_id`: `reverse-demo-migration`

response:
```
{
  "message": "ok"
}
```

## 删除一个迁移/同步/订阅作业

#### API: `POST /v2/job/job_type/delete`

#### 请求参数说明

| 参数名         | 必填?           | 类型        | 默认值         | 说明            |
| ------------- | -------------- | ---------- | ---------- | ------------- |
| job_id        | 是             | String      | ""        | 要删除的job id |  

#### 响应参数说明
返回删除结果

#### 样例
params：  
`job_id`: `demo-migration`

response:
```
{
  "message": "ok"
}
```

## 列出迁移/同步/订阅下所有作业

#### API: `GET /v2/jobs/job_type`  

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------         | -------------  | ------------- | ------------- | -------------        
| filter_job_name       | 否             | String       | ""        | 过滤器，根据job名过滤请求结果
| filter_job_status     | 否             | String       | ""        | 过滤器，根据job状态过滤请求结果
| filter_job_src_ip     | 否             | String       | ""        | 过滤器，根据job源端ip过滤请求结果
| filter_job_src_port   | 否             | String       | ""        | 过滤器，根据job源端port过滤请求结果
| filter_job_dest_ip    | 否             | String       | ""        | 过滤器，根据job目标端ip过滤请求结果
| filter_job_dest_port  | 否             | String       | ""        | 过滤器，根据job目标端port过滤请求结果
| order_by              | 否             | String       | ""        | 排序

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| jobs.job_id    | String      | job id
| jobs.job_status    | String      | job运行状态，注意区分job状态和task状态，如果某个job下有task失败，此时获取到的job状态仍可能为"running"，因为job负责管理和调度task，它确实是处于正常运行状态，它可能正在对失败的task做重试、重新分配等工作
| jobs.topic    | String      |  订阅任务专用topic
| jobs.job_create_time  | String      | 任务创建时间
| jobs.src_addr_list    | []String      | 源端地址
| jobs.dst_addr_list    | []String      | 目标端地址
| jobs.user             | String        | 创建任务用户

#### 样例
params：  
```filter_job_name```: ""
```filter_job_status```: ""
```filter_job_src_ip```: ""
```filter_job_src_port```: ""
```filter_job_dest_ip```: ""
```filter_job_dest_port```: ""
```order_by```: ""

response:
```
{
    "jobs":[
        {
            "job_id":"demo-migration",
            "job_status":"running",
            "topic":"",
            "job_create_time":"2021-09-06T03:26:41Z",
            "src_addr_list":[
                "10.186.63.18:33061"
            ],
            "dst_addr_list":[
                "10.186.63.18:33062"
            ],
            "user":"platform:admin",
            "job_steps":[
                {
                    "step_name":"job_stage_full",
                    "step_status":"start",
                    "step_schedule":0,
                    "job_create_time":"2021-09-06T03:26:41Z"
                }
            ]
        }
    ],
    "message":"ok"
}
```

## 获取某个迁移作业的详细信息

#### API: `GET /v2/job/migration/detail`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| job_id     | 是             | String       | ""        | 要查询的job id

#### 样例
params：  
```job_id```: ```demo-migration```

response:
```
{
    "basic_task_profile":{
        "job_base_info":{
            "job_id":"demo-migration",
            "subscription_topic":"",
            "job_status":"running",
            "job_create_time":"2021-09-06T03:26:41Z",
            "job_steps":[
                {
                    "step_name":"job_stage_full",
                    "step_status":"start",
                    "step_schedule":0,
                    "job_create_time":"2021-09-06T03:26:41Z"
                }
            ],
            "delay":0
        },
        "dtle_node_infos":[
            {
                "node_addr":"127.0.0.1",
                "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
                "data_source":"10.186.63.18:33061",
                "source":"src"
            },
            {
                "node_addr":"127.0.0.1",
                "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
                "data_source":"10.186.63.18:33062",
                "source":"dst"
            }
        ],
        "connection_info":{
            "src_data_base":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33061,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "dst_data_base":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33062,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "dst_kafka":{
                "task_name":"",
                "kafka_broker_addrs":null,
                "kafka_topic":"",
                "message_group_max_size":0,
                "message_group_timeout":0
            }
        },
        "configuration":{
            "binlog_relay":false,
            "fail_over":true,
            "retry_times":2,
            "parallel_workers":1,
            "repl_chan_buffer_size":120,
            "group_max_size":1,
            "chunk_size":2000,
            "group_timeout":100,
            "drop_table_if_exists":true,
            "skip_create_db_table":false,
            "use_my_sql_dependency":true,
            "dependency_history_size":2500
        },
        "replicate_do_db":[
            {
                "table_schema":"demo",
                "table_schema_regex":"",
                "table_schema_rename":"",
                "tables":[
                    {
                        "table_name":"demo_tbl",
                        "table_regex":"",
                        "table_rename":"",
                        "column_map_from":null,
                        "where":""
                    }
                ]
            }
        ],
        "replicate_ignore_db":[

        ]
    },
    "task_logs":[
        {
            "task_events":[
                {
                    "event_type":"Received",
                    "setup_error":"",
                    "message":"Task received by client",
                    "time":"2021-09-06T03:26:41Z"
                },
                {
                    "event_type":"Task Setup",
                    "setup_error":"",
                    "message":"Building Task Directory",
                    "time":"2021-09-06T03:26:41Z"
                },
                {
                    "event_type":"Started",
                    "setup_error":"",
                    "message":"Task started by client",
                    "time":"2021-09-06T03:26:41Z"
                },
                {
                    "event_type":"Signaling",
                    "setup_error":"",
                    "message":"Task being sent a signal",
                    "time":"2021-09-06T05:37:21Z"
                },
                {
                    "event_type":"Signaling",
                    "setup_error":"",
                    "message":"Task being sent a signal",
                    "time":"2021-09-06T05:42:23Z"
                }
            ],
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "allocation_id":"6a8fe2af-99fd-7880-0989-35a4d3fed0de",
            "address":"127.0.0.1",
            "target":"src"
        },
        {
            "task_events":[
                {
                    "event_type":"Driver",
                    "setup_error":"",
                    "message":"job_stage_incr",
                    "time":"2021-09-06T03:20:08Z"
                },
                {
                    "event_type":"Terminated",
                    "setup_error":"",
                    "message":"Exit Code: 2, Exit Message: \"DstPutNats: NatsAddr changed to wait. will restart dst\"",
                    "time":"2021-09-06T03:26:41Z"
                },
                {
                    "event_type":"Restarting",
                    "setup_error":"",
                    "message":"Task restarting in 18.388197111s",
                    "time":"2021-09-06T03:26:41Z"
                },
                {
                    "event_type":"Started",
                    "setup_error":"",
                    "message":"Task started by client",
                    "time":"2021-09-06T03:26:59Z"
                },
                {
                    "event_type":"Driver",
                    "setup_error":"",
                    "message":"job_stage_full",
                    "time":"2021-09-06T03:26:59Z"
                },
                {
                    "event_type":"Driver",
                    "setup_error":"",
                    "message":"job_stage_incr",
                    "time":"2021-09-06T03:26:59Z"
                },
                {
                    "event_type":"Signaling",
                    "setup_error":"",
                    "message":"Task being sent a signal",
                    "time":"2021-09-06T05:37:21Z"
                },
                {
                    "event_type":"Signaling",
                    "setup_error":"",
                    "message":"Task being sent a signal",
                    "time":"2021-09-06T05:42:23Z"
                },
                {
                    "event_type":"Driver",
                    "setup_error":"",
                    "message":"job_stage_full",
                    "time":"2021-09-06T05:42:23Z"
                },
                {
                    "event_type":"Driver",
                    "setup_error":"",
                    "message":"job_stage_incr",
                    "time":"2021-09-06T05:42:23Z"
                }
            ],
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "allocation_id":"f9d36de1-b309-6252-e203-e342d3dcfe80",
            "address":"127.0.0.1",
            "target":"dst"
        }
    ],
    "message":"ok"
}
```

## 获取某个同步作业的详细信息

#### API: `GET /v2/job/sync/detail`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| job_id     | 是             | String       | ""        | 要查询的job id

#### 样例
params：  
```job_id```: ```demo-sync```

response:
```
{
    "basic_task_profile":{
        "job_base_info":{
            "job_id":"demo-sync",
            "subscription_topic":"",
            "job_status":"running",
            "job_create_time":"2021-09-06T05:28:55Z",
            "job_steps":[
                {
                    "step_name":"job_stage_incr",
                    "step_status":"start",
                    "step_schedule":0,
                    "job_create_time":"2021-09-06T05:28:55Z"
                }
            ],
            "delay":0
        },
        "dtle_node_infos":[
            {
                "node_addr":"127.0.0.1",
                "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
                "data_source":"10.186.63.18:33061",
                "source":"src"
            },
            {
                "node_addr":"127.0.0.1",
                "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
                "data_source":"10.186.63.18:33062",
                "source":"dst"
            }
        ],
        "connection_info":{
            "src_data_base":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33061,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "dst_data_base":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33062,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "dst_kafka":{
                "task_name":"",
                "kafka_broker_addrs":null,
                "kafka_topic":"",
                "message_group_max_size":0,
                "message_group_timeout":0
            }
        },
        "configuration":{
            "binlog_relay":false,
            "fail_over":true,
            "retry_times":2,
            "parallel_workers":1,
            "repl_chan_buffer_size":120,
            "group_max_size":1,
            "chunk_size":2000,
            "group_timeout":100,
            "drop_table_if_exists":true,
            "skip_create_db_table":false,
            "use_my_sql_dependency":true,
            "dependency_history_size":2500
        },
        "replicate_do_db":[
            {
                "table_schema":"demo",
                "table_schema_regex":"",
                "table_schema_rename":"",
                "tables":[
                    {
                        "table_name":"demo_tbl",
                        "table_regex":"",
                        "table_rename":"",
                        "column_map_from":null,
                        "where":""
                    }
                ]
            }
        ],
        "replicate_ignore_db":[

        ]
    },
    "task_logs":[
        {
            "task_events":[
                {
                    "event_type":"Received",
                    "setup_error":"",
                    "message":"Task received by client",
                    "time":"2021-09-06T05:27:16Z"
                },
                {
                    "event_type":"Task Setup",
                    "setup_error":"",
                    "message":"Building Task Directory",
                    "time":"2021-09-06T05:27:16Z"
                },
                {
                    "event_type":"Started",
                    "setup_error":"",
                    "message":"Task started by client",
                    "time":"2021-09-06T05:27:16Z"
                },
                {
                    "event_type":"Killing",
                    "setup_error":"",
                    "message":"Sent interrupt. Waiting 5s before force killing",
                    "time":"2021-09-06T05:28:55Z"
                },
                {
                    "event_type":"Terminated",
                    "setup_error":"",
                    "message":"Exit Code: 0",
                    "time":"2021-09-06T05:28:55Z"
                },
                {
                    "event_type":"Killed",
                    "setup_error":"",
                    "message":"Task successfully killed",
                    "time":"2021-09-06T05:28:55Z"
                }
            ],
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "allocation_id":"369abffd-c20f-02a7-d59c-8ba1972fc7da",
            "address":"127.0.0.1",
            "target":"src"
        },
        {
            "task_events":[
                {
                    "event_type":"Received",
                    "setup_error":"",
                    "message":"Task received by client",
                    "time":"2021-09-06T05:28:55Z"
                },
                {
                    "event_type":"Task Setup",
                    "setup_error":"",
                    "message":"Building Task Directory",
                    "time":"2021-09-06T05:28:55Z"
                },
                {
                    "event_type":"Started",
                    "setup_error":"",
                    "message":"Task started by client",
                    "time":"2021-09-06T05:28:55Z"
                }
            ],
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "allocation_id":"3fba0699-48ad-2265-30e3-8c767fbeed25",
            "address":"127.0.0.1",
            "target":"src"
        },
        {
            "task_events":[
                {
                    "event_type":"Received",
                    "setup_error":"",
                    "message":"Task received by client",
                    "time":"2021-09-06T05:27:16Z"
                },
                {
                    "event_type":"Task Setup",
                    "setup_error":"",
                    "message":"Building Task Directory",
                    "time":"2021-09-06T05:27:16Z"
                },
                {
                    "event_type":"Started",
                    "setup_error":"",
                    "message":"Task started by client",
                    "time":"2021-09-06T05:27:16Z"
                },
                {
                    "event_type":"Driver",
                    "setup_error":"",
                    "message":"job_stage_full",
                    "time":"2021-09-06T05:27:16Z"
                },
                {
                    "event_type":"Driver",
                    "setup_error":"",
                    "message":"job_stage_incr",
                    "time":"2021-09-06T05:27:17Z"
                },
                {
                    "event_type":"Terminated",
                    "setup_error":"",
                    "message":"Exit Code: 2, Exit Message: \"DstPutNats: NatsAddr changed to wait. will restart dst\"",
                    "time":"2021-09-06T05:28:55Z"
                },
                {
                    "event_type":"Restarting",
                    "setup_error":"",
                    "message":"Task restarting in 18.343194092s",
                    "time":"2021-09-06T05:28:55Z"
                },
                {
                    "event_type":"Started",
                    "setup_error":"",
                    "message":"Task started by client",
                    "time":"2021-09-06T05:29:13Z"
                },
                {
                    "event_type":"Driver",
                    "setup_error":"",
                    "message":"job_stage_full",
                    "time":"2021-09-06T05:29:13Z"
                },
                {
                    "event_type":"Driver",
                    "setup_error":"",
                    "message":"job_stage_incr",
                    "time":"2021-09-06T05:29:13Z"
                }
            ],
            "node_id":"85148787-a6ba-016f-d9d2-3bc3522a573a",
            "allocation_id":"25830ed3-52a1-52df-e2b5-b9d0db4f0249",
            "address":"127.0.0.1",
            "target":"dst"
        }
    ],
    "message":"ok"
}
```

## 获取某个订阅作业的详细信息

#### API: `GET /v2/job/subscription/detail`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| job_id     | 是             | String       | ""        | 要查询的job id

#### 样例
params：  
```job_id```: ```demo-subscription```

response:
```
{
    "basic_task_profile":{
        "job_base_info":{
            "job_id":"demo-subscription",
            "subscription_topic":"subTopick",
            "job_status":"running",
            "job_create_time":"2021-09-06T09:03:05Z",
            "job_steps":[
                {
                    "step_name":"job_stage_full",
                    "step_status":"start",
                    "step_schedule":0,
                    "job_create_time":"2021-09-06T09:03:05Z"
                }
            ],
            "delay":0
        },
        "dtle_node_infos":[
            {
                "node_addr":"127.0.0.1",
                "node_id":"ab0a1cf9-6100-fb9e-6e9a-ca2e898b4d57",
                "data_source":"10.186.63.18:33061",
                "source":"src"
            },
            {
                "node_addr":"127.0.0.1",
                "node_id":"ab0a1cf9-6100-fb9e-6e9a-ca2e898b4d57",
                "data_source":"10.186.63.18:9092",
                "source":"dst"
            }
        ],
        "connection_info":{
            "src_data_base":{
                "mysql_host":"10.186.63.18",
                "mysql_port":33061,
                "mysql_user":"root",
                "mysql_password":"*"
            },
            "dst_data_base":{
                "mysql_host":"",
                "mysql_port":0,
                "mysql_user":"",
                "mysql_password":""
            },
            "dst_kafka":{
                "task_name":"dest",
                "kafka_broker_addrs":[
                    "10.186.63.18:9092"
                ],
                "kafka_topic":"subTopick",
                "message_group_max_size":1,
                "message_group_timeout":100
            }
        },
        "configuration":{
            "binlog_relay":false,
            "fail_over":true,
            "retry_times":2,
            "parallel_workers":0,
            "repl_chan_buffer_size":120,
            "group_max_size":1,
            "chunk_size":2000,
            "group_timeout":100,
            "drop_table_if_exists":true,
            "skip_create_db_table":false,
            "use_my_sql_dependency":false,
            "dependency_history_size":0
        },
        "replicate_do_db":[

        ],
        "replicate_ignore_db":[

        ]
    },
    "task_logs":[
        {
            "task_events":[
                {
                    "event_type":"Received",
                    "setup_error":"",
                    "message":"Task received by client",
                    "time":"2021-09-06T09:03:05Z"
                },
                {
                    "event_type":"Task Setup",
                    "setup_error":"",
                    "message":"Building Task Directory",
                    "time":"2021-09-06T09:03:05Z"
                },
                {
                    "event_type":"Started",
                    "setup_error":"",
                    "message":"Task started by client",
                    "time":"2021-09-06T09:03:05Z"
                }
            ],
            "node_id":"ab0a1cf9-6100-fb9e-6e9a-ca2e898b4d57",
            "allocation_id":"5bce902f-c824-2a95-5b0e-523f3a11c312",
            "address":"127.0.0.1",
            "target":"src"
        },
        {
            "task_events":[
                {
                    "event_type":"Received",
                    "setup_error":"",
                    "message":"Task received by client",
                    "time":"2021-09-06T09:03:05Z"
                },
                {
                    "event_type":"Task Setup",
                    "setup_error":"",
                    "message":"Building Task Directory",
                    "time":"2021-09-06T09:03:05Z"
                },
                {
                    "event_type":"Started",
                    "setup_error":"",
                    "message":"Task started by client",
                    "time":"2021-09-06T09:03:05Z"
                }
            ],
            "node_id":"ab0a1cf9-6100-fb9e-6e9a-ca2e898b4d57",
            "allocation_id":"b3aa6a5c-8635-d9aa-3c03-6aa6e7322bf7",
            "address":"127.0.0.1",
            "target":"dst"
        }
    ],
    "message":"ok"
}
```

## 校验作业配置

#### API: `GET /v2/validation/job`
注意：目前只支持对MySQL-to-MySQL的job校验

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| job_config     | 是             | JSON Object       | ""        | 参考`POST /v2/job/migration`的`migration_job_config`配置

#### 响应参数说明

| 参数名                       | 类型        | 说明                                                                                                                                                                                                                                               |
| --------------------------- | ---------- | -------------                                                                                                                                                                                                                                 |
| driver_config_validated    | bool        | 是否校验driver
| job_validation_error       | String       | 校验job配置的错误信息
| job_validation_warning    | String        | 校验job配置的警告信息
| mysql_task_validation_report | JSON Array | task的校验结果
| mysql_task_validation_report.task_name | String | task名称
| mysql_task_validation_report.binlog_validation | JSON Object | binlog校验结果
| mysql_task_validation_report.connection_validation | JSON Object | dtle和数据库的连接校验结果
| mysql_task_validation_report.gtid_mode_validation | JSON Object | gtid mode校验结果
| mysql_task_validation_report.privileges_validation | JSON Object | 用户权限校验结果
| mysql_task_validation_report.server_id_validation | JSON Object | MySQL server ID校验结果

#### 样例
params：  
`job_config`: 
```{
  "is_mysql_password_encrypted": true,
  "failover": true,
  "dest_task": {
  	"mysql_connection_config": {
      "mysql_host": "10.186.63.28",
      "mysql_password": "vo0+U/SoBFC2QHE1KSunmAIZGpkxpXRWyDJVMNZ3HaQGQRcrVl2w/VuT2gfdD76Pj/Te+24LMBDeoWyNzc8w1NBNqL2+BD7uuLl2aAHPrarhY07LvI2X3NC8n59c0ozN/3+uJPvX7YQ5w8jMjm8xD4qhtI99PkBtC+hfjP1WY38=",
      "mysql_port": 3308,
      "mysql_user": "test"
    },
    "task_name": "dest"
  },
  "job_name": "job1",
  "src_task": {
  	"mysql_connection_config": {
      "mysql_host": "10.186.63.28",
      "mysql_password": "vo0+U/SoBFC2QHE1KSunmAIZGpkxpXRWyDJVMNZ3HaQGQRcrVl2w/VuT2gfdD76Pj/Te+24LMBDeoWyNzc8w1NBNqL2+BD7uuLl2aAHPrarhY07LvI2X3NC8n59c0ozN/3+uJPvX7YQ5w8jMjm8xD4qhtI99PkBtC+hfjP1WY38=",
      "mysql_port": 3307,
      "mysql_user": "test"
    },
    "replicate_do_db": [
      {
        "table_schema": "db1",
        "tables": [
          {
            "table_name": "tb1"
          }
        ]
      }
    ],
    "task_name": "src"
  }
}
```

response:
```
{
  "driver_config_validated": true,
  "mysql_task_validation_report": [
    {
      "task_name": "src",
      "connection_validation": {
        "validated": true,
        "error": ""
      },
      "privileges_validation": {
        "validated": true,
        "error": ""
      },
      "gtid_mode_validation": {
        "validated": true,
        "error": ""
      },
      "server_id_validation": {
        "validated": true,
        "error": ""
      },
      "binlog_validation": {
        "validated": true,
        "error": ""
      }
    },
    {
      "task_name": "dest",
      "connection_validation": {
        "validated": true,
        "error": ""
      },
      "privileges_validation": {
        "validated": true,
        "error": ""
      },
      "gtid_mode_validation": null,
      "server_id_validation": null,
      "binlog_validation": null
    }
  ],
  "job_validation_error": "",
  "job_validation_warning": "",
  "message": "ok"
}
```

## 查看某个任务执行的状态

API: `GET /v2/monitor/task`

#### 请求参数说明

| 参数名               | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | -------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| allocation_id       | 是             | String       | ""        | 要查询的任务的allocation id
| task_name           | 是             | String       | ""        | 要查询的任务名称
| nomad_http_address  | 否             | String       | ""        | dtle内部使用，可以忽略

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| file    | String      | 正在复制的binlog文件名
| gtid_set    | String      | 已复制的GTID集合
| delay_count    | JSON Object      | 延时统计
| progress_PCT    | String      | 全量复制进度
| ETA    | String      | 全量复制预估剩余时间
| nats_message_status    | JSON Object  | Nats网络吞吐数据
| stage    | String  | 复制阶段
| timestamp    | Timestamp  | 当前时间

#### 样例
params：  
`allocation_id`: `0d3939ec-a499-90e3-6bfe-f857448712f9`
`task_name`: `src`

response:
```
{
  "tasks_status": {
    "current_coordinates": {
      "file": "mysql-bin.000001",
      "position": 154,
      "gtid_set": "00003307-1111-1111-1111-111111111111:1-24",
      "relay_master_log_file": "",
      "read_master_log_pos": 0,
      "retrieved_gtid_set": ""
    },
    "delay_count": {
      "num": 0,
      "time": 0
    },
    "progress_PCT": "100.0",
    "exec_master_row_count": 4,
    "exec_master_tx_count": 958859,
    "read_master_row_count": 4,
    "read_master_tx_count": 958859,
    "ETA": "0s",
    "backlog": "0/128",
    "throughput_status": null,
    "nats_message_status": {
      "in_messages": 5,
      "out_messages": 5,
      "in_bytes": 0,
      "out_bytes": 1021,
      "reconnects": 0
    },
    "buffer_status": {
      "binlog_event_queue_size": 0,
      "extractor_tx_queue_size": 0,
      "applier_tx_queue_size": 0,
      "send_by_timeout": 0,
      "send_by_size_full": 0
    },
    "stage": "Master has sent all binlog to slave; waiting for more updates",
    "timestamp": 1620882952091441700
  },
  "message": "ok"
}
```

## 列出所有节点

API: `GET /v2/nodes`

#### 请求参数说明

没有请求参数

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| nodes    | JSON Array      | 所有节点信息
| nodes.node_name    | String      | 节点的hostname
| nodes.node_address    | String      | 节点的IP
| nodes.node_id    | String      | 节点ID
| nodes.node_status    | String      | 节点状态
| nodes.node_status_description    | String      | 节点状态描述
| nodes.datacenter    | String      | 节点所在的datacenter
| nodes.dtle_version    | String      | 节点的dtle版本
| nodes.nomad_version    | String      | 节点的nomad版本

#### 样例

response:
```
{
    "nodes":[
        {
            "node_address":"127.0.0.1",
            "node_name":"nomad0",
            "node_id":"ab0a1cf9-6100-fb9e-6e9a-ca2e898b4d57",
            "node_status":"ready",
            "node_status_description":"",
            "datacenter":"dc1",
            "nomad_version":"1.1.2",
            "dtle_version":"3.21.08.0-3.21.08.x-e56bde2"
        }
    ],
    "message":"ok"
}
```

## 获取MySQL实例的schemas

#### API: `GET /v2/mysql/schemas`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| mysql_host          | 是             | String       | ""        | MySQL所在主机IP
| mysql_port          | 是             | String       | ""        | MySQL端口
| mysql_user          | 是             | String       | ""        | MySQL连接用户
| mysql_password      | 是             | String       | ""        | MySQL连接密码
| mysql_character_set     | 否         | String       | "utf8mb4"        | MySQL字符集
| is_mysql_password_encrypted     | 否             | String       | false        | MySQL密码是否经过加密。设置is_mysql_password_encrypted=true时，认为所填写的```mysql_password```经过两次加密（先是rsa/none/pkcs1 padding 加密，再做base64编码），要求将rsa密钥以pem格式保存在文件中，再将文件绝对路径配置到nomad.hcl的```rsa_private_key_path```参数（配置方法见["节点配置"](./4.1_node_configuration.md)）；设置is_mysql_password_encrypted=false时，```mysql_password```填写明文密码。

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| schemas    | JSON Array      | 在MySQL实例上执行`show databases`获取到的schema
| schemas.schema_name    | String      | schema名称
| schemas.tables    | JSON Array      | 在某个schema上执行`show tables`获取到的table
| schemas.tables.table_name    | String | table名称

#### 样例
response:
```
{
  "schemas": [
    {
      "schema_name": "db1",
      "Tables": [
        {
          "table_name": "tb1"
        }
      ]
    },
    {
      "schema_name": "dbtest",
      "Tables": []
    },
    {
      "schema_name": "test",
      "Tables": []
    }
  ],
  "message": "ok"
}
```

## 验证MySQL实例的连通性

#### API: `GET /v2/mysql/instance_connection`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| mysql_host          | 是             | String       | ""        | MySQL所在主机IP
| mysql_port          | 是             | String       | ""        | MySQL端口
| mysql_user          | 是             | String       | ""        | MySQL连接用户
| mysql_password      | 是             | String       | ""        | MySQL连接密码
| is_mysql_password_encrypted     | 否             | String       | false        | MySQL密码是否经过加密。设置is_mysql_password_encrypted=true时，认为所填写的```mysql_password```经过两次加密（先是rsa/none/pkcs1 padding 加密，再做base64编码），要求将rsa密钥以pem格式保存在文件中，再将文件绝对路径配置到nomad.hcl的```rsa_private_key_path```参数（配置方法见["节点配置"](./4.1_node_configuration.md)）；设置is_mysql_password_encrypted=false时，```mysql_password```填写明文密码。

#### 响应参数说明
联通性结果

#### 样例
params：  
`mysql_host=10.186.63.18&mysql_port=33061&mysql_user=root&mysql_password=ztPqAK1J5uExymUNJvDGMfbNGs7uHrNS%2BTyZodvaR3R24cgOf94AF4w2qp2xqj%2FqC%2FcVtKwWi%2ByhhViWP8UepNjl5hxQMi%2BnYiwCjRHercSRacdX21YulXElhZMp%2F%2BU7KYwWjIznsViVYZkinoXyJShKpmXczyb9UBTpoelqu0w%3D&is_mysql_password_encrypted=true`

response:
```
{
  "message": "ok"
}
```

## 获取MySQL实例指定schema下的table的所有columns

#### API: `GET /v2/mysql/columns`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| mysql_host          | 是             | String       | ""        | MySQL所在主机IP
| mysql_port          | 是             | String       | ""        | MySQL端口
| mysql_user          | 是             | String       | ""        | MySQL连接用户
| mysql_password      | 是             | String       | ""        | MySQL连接密码
| mysql_schema      | 是             | String       | ""        | MySQL指定库
| mysql_table      | 是             | String       | ""        | MySQL指定表
| mysql_character_set     | 否         | String       | "utf8mb4"        | MySQL字符集
| is_mysql_password_encrypted     | 否             | String       | false        | MySQL密码是否经过加密。设置is_mysql_password_encrypted=true时，认为所填写的```mysql_password```经过两次加密（先是rsa/none/pkcs1 padding 加密，再做base64编码），要求将rsa密钥以pem格式保存在文件中，再将文件绝对路径配置到nomad.hcl的```rsa_private_key_path```参数（配置方法见["节点配置"](./4.1_node_configuration.md)）；设置is_mysql_password_encrypted=false时，```mysql_password```填写明文密码。

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| columns    | String Array      | 在MySQL实例上执行`use mysql_schema;select COLUMN_NAME from information_schema.columns where table_name = '?'`获取到的列数据

#### 样例
response:
```
{
  "columns": [
    "id",
    "c_bit_1"
  ],
  "message": "ok"
}
```

## 修改日志等级
通过该API可以动态修改日志等级，修改步骤如下： 
如要将日志等级变更为`DEBUG`
1 修改nomad.hcl配置文件中的nomad及dtle日志等级为`DEBUG`，如
```
# nomad.hcl
...
log_level = "DEBUG"
...

plugin "dtle" {
  config {
...
    log_level = "DEBUG"
...
  }
}
```
2 调用API，请求参数`dtle_log_level`传入`DEBUG`
3 查看日志，检查内容等级是否变更

#### API: `POST /v2/log/level`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------                                                                                                                                                                                                                                    |
| dtle_log_level     | 是             | String       | ""        | 要修改的日志等级，支持`TRACE, DEBUG, INFO, WARN, ERROR`

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| dtle_log_level    | String    | 修改后的日志等级

#### 样例
params：  
`dtle_log_level`: `DEBUG`

response:
```
{
  "dtle_log_level": "DEBUG",
  "message": "ok"
}
```

## 用户列表

#### API: `GET /v2/user/list`  

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------        
| filter_username     | 否             | String       | ""        | 过滤器，根据用户名过滤请求结果
| filter_tenant     | 否             | String       | ""        | 过滤器，根据租户名过滤请求结果

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| user_list.username    | String      | 用户名
| user_list.tenant    | String      | 租户名
| user_list.role    | String      |  用户所属角色
| user_list.password    | String      | 用户密码（*）
| user_list.create_time    | time.time      | 创建时间
| user_list.remark    | String      |  备注信息

#### 样例
params：  
```filter_username```: ""
```filter_tenant```: ""

response:
```
{
    "user_list":[
        {
            "username":"admin",
            "tenant":"platform",
            "role":"admin",
            "password":"*",
            "create_time":"2021-09-06T07:02:37Z",
            "remark":""
        }
    ],
    "message":"ok"
}
```

## 创建新用户

#### API: `POST /v2/user/create`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| user_name  | 是             | String       | ""        | 用户名/  
| tenant  | 是             | String       | ""        | 租户名|  
| role  | 是             | String       | ""        | 用户所属角色 |  
| remark  | 否             | String       | ""        | 备注 |  
| pass_word  | 是             | String       | ""        | 用户密码 |  

#### 响应参数说明

返回创建结果

#### 样例
params：  
```
{
    "pass_word":"RXBljXmt8grSr9i9OT9URgrlOTSZQoG/qRrC9uc3NE6AEFkGuKorh1TCAlfQtOfC/SvykczwAX7aIcN1ajCsv8mvkeeXDmFNxmr9eOrzV0mOy4jhqnzJys7uzoKGvXzzFZ/g4M+Q/uzmZSea24M7KhwBBimFTMP3s9Ahn5dsitk=",
    "role":"admin",
    "tenant":"platform",
    "username":"test",
    "remark":"*"
}
```

response:
```
{
    "message":"ok"
}
```

## 更新用户信息

#### API: `POST /v2/user/update`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| user_name  | 是             | String       | ""        | 用户名/  
| tenant  | 是             | String       | ""        | 租户名|  
| role  | 是             | String       | ""        | 用户所属角色 |  
| remark  | 否             | String       | ""        | 备注 |    

#### 响应参数说明

返回创建结果

#### 样例
params：  
```
{
    "remark":"railen*188*****5229",
    "role":"admin",
    "tenant":"platform",
    "username":"test"
}
```

response:
```
{
    "message":"ok"
}
```

## 重置用户密码

#### API: `POST /v2/user/reset_password`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| user_name  | 是             | String       | ""        | 用户名/  
| tenant  | 是             | String       | ""        | 租户名|    
| current_user_password  | 是             | String       | ""        | 当前用户密码 |  
| pass_word  | 是             | String       | ""        | 用户密码 |  

#### 响应参数说明

返回创建结果

#### 样例
params：  
```
{
    "current_user_password":"eUa9jNysWv6a0lpzkDoH9tS5T2zoetoG6qwkbtPo99j6dLd1NdWMWeH15qwBJl9VSrMceGZhTsw9NxwgT2XC8MVITSA2VDwqyEwACmkVKu2PcVPJVkT9G1uhGeH7GBgkHJsIZ50b3K16DSpCfYOfbPsUXcCAKAlLmG8BmITM3z4=",
    "password":"xF3ieRGiVj8NQV7+bj5Cclwd+lBA3peUpK3xVlswrUn5qpHp4OBmq6dZq4VluMGAyXHeWCMy9Ffcehb0gf6ISCP4axDP7FdTf+fiMOIlCkVM0O8DJOQKN9QMtca9uD3xv3uacbrEft0N5+TDnIGRhzo1gXttd169xUIR7mNWFEQ=",
    "tenant":"platform",
    "username":"test"
}
```

response:
```
{
    "message":"ok"
}
```

## 删除用户

#### API: `POST /v2/user/delete`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| user_name  | 是             | String       | ""        | 用户名/  
| tenant  | 是             | String       | ""        | 租户名|    

#### 响应参数说明

返回创建结果

#### 样例
params：  
```
   "tenant":"platform",
   "username":"test"
```

response:
```
{
    "message":"ok"
}
```

## 租户列表

#### API: `GET /v2/tenant/list`  

#### 请求参数说明

无

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| user_list.username    | String      | 用户名
| user_list.tenant    | String      | 租户名
| user_list.role    | String      |  用户所属角色
| user_list.password    | String      | 用户密码（*）
| user_list.create_time    | time.time      | 创建时间
| user_list.remark    | String      |  备注信息

#### 样例 
response:
```
{
    "tenant_list":[
        "platform"
    ],
    "message":"ok"
}
```

## 获取当前用户信息

#### API: `GET /v2/user/current_user`

#### 请求参数说明

无

#### 样例
response:
```
{
    "current_user":{
        "username":"admin",
        "tenant":"platform",
        "role":"admin",
        "password":"*",
        "create_time":"2021-09-06T07:02:37Z",
        "remark":""
    },
    "message":"ok"
}
```

## 列出当前用户动作权限

API: `GET /v2/user/list_action`

#### 请求参数说明

没有请求参数

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| authority    | JSON Array      | 当前用户的所有菜单权限
| menu_item.name    | String      | 菜单名
| menu_item.text_cn    | String      | 菜单中文翻译
| menu_item.text_en    | String      | 菜单英文翻译
| menu_item.menu_level    | String      | 菜单层级
| menu_item.menu_url    | String      | 菜单路由
| menu_item.id    | String      | 菜单id
| menu_item.parent_id    | String      | 菜单的父级id
| menu_item.operations    | JSON Array      | 菜单下的所有按钮权限
| menu_item.admin_only    | String      | 是否仅管理员可见

#### 样例

response:
```
{
    "authority":[
        {
            "name":"service",
            "text_cn":"服务",
            "text_en":"service",
            "menu_level":1,
            "menu_url":"",
            "id":1,
            "parent_id":0,
            "operations":[

            ],
            "admin_only":false
        },
        {
            "name":"migration",
            "text_cn":"数据迁移",
            "text_en":"migration",
            "menu_level":2,
            "menu_url":"/migration",
            "id":2,
            "parent_id":1,
            "operations":[
                {
                    "action":"migration-list",
                    "uri":"/v2/jobs/migration",
                    "text_cn":"迁移任务列表",
                    "text_en":"migration job list"
                },
                {
                    "action":"migration-create",
                    "uri":"/v2/job/migration/create",
                    "text_cn":"迁移创建任务",
                    "text_en":"create migration job"
                },
                {
                    "action":"migration-pause",
                    "uri":"/v2/job/migration/pause",
                    "text_cn":"暂停任务",
                    "text_en":"pause migration job"
                },
                {
                    "action":"migration-resume",
                    "uri":"/v2/job/migration/resume",
                    "text_cn":"重启迁移任务",
                    "text_en":"resume migration job"
                },
                {
                    "action":"migration-delete",
                    "uri":"/v2/job/migration/delete",
                    "text_cn":"销毁迁移任务",
                    "text_en":"delete migration job"
                },
                {
                    "action":"migration-reverse",
                    "uri":"/v2/job/migration/reverse",
                    "text_cn":"创建迁移反向复制任务",
                    "text_en":"reverse migration job"
                },
                {
                    "action":"migration-reverse_start",
                    "uri":"/v2/job/migration/reverse_start",
                    "text_cn":"启动迁移反向任务",
                    "text_en":"start migration reverse job "
                },
                {
                    "action":"migration-update",
                    "uri":"/v2/job/migration/update",
                    "text_cn":"修改迁移任务",
                    "text_en":"update migration job"
                },
                {
                    "action":"migration-detail",
                    "uri":"/v2/job/migration/detail",
                    "text_cn":"查看迁移任务详情",
                    "text_en":"migration detail job"
                }
            ],
            "admin_only":false
        },
        {
            "name":"sync",
            "text_cn":"数据同步",
            "text_en":"sync",
            "menu_level":2,
            "menu_url":"/sync",
            "id":3,
            "parent_id":1,
            "operations":[
                {
                    "action":"sync-list",
                    "uri":"/v2/jobs/sync",
                    "text_cn":"同步任务列表",
                    "text_en":"sync job list"
                },
                {
                    "action":"sync-create",
                    "uri":"/v2/job/sync/create",
                    "text_cn":"创建同步任务",
                    "text_en":"create sync job"
                },
                {
                    "action":"sync-pause",
                    "uri":"/v2/job/sync/pause",
                    "text_cn":"暂停同步任务",
                    "text_en":"pause sync job"
                },
                {
                    "action":"sync-resume",
                    "uri":"/v2/job/sync/resume",
                    "text_cn":"重启同步任务",
                    "text_en":"resume sync job"
                },
                {
                    "action":"sync-delete",
                    "uri":"/v2/job/sync/delete",
                    "text_cn":"销毁同步任务",
                    "text_en":"delete sync job"
                },
                {
                    "action":"sync-reverse",
                    "uri":"/v2/job/sync/reverse",
                    "text_cn":"反向复制同步任务",
                    "text_en":"reverse sync job"
                },
                {
                    "action":"sync-reverse_start",
                    "uri":"/v2/job/sync/reverse_start",
                    "text_cn":"启动同步反向任务",
                    "text_en":"reverse start sync job"
                },
                {
                    "action":"sync-update",
                    "uri":"/v2/job/sync/update",
                    "text_cn":"修改同步任务",
                    "text_en":"update sync job"
                },
                {
                    "action":"sync-detail",
                    "uri":"/v2/job/sync/detail",
                    "text_cn":"查看同步任务详情",
                    "text_en":"sync job detail "
                }
            ],
            "admin_only":false
        },
        {
            "name":"subscription",
            "text_cn":"数据订阅",
            "text_en":"subscription",
            "menu_level":2,
            "menu_url":"/subscribe",
            "id":4,
            "parent_id":1,
            "operations":[
                {
                    "action":"subscription-list",
                    "uri":"/v2/jobs/subscription",
                    "text_cn":"订阅任务列表",
                    "text_en":"subscription job list"
                },
                {
                    "action":"subscription-create",
                    "uri":"/v2/job/subscription/create",
                    "text_cn":"创建订阅任务",
                    "text_en":"create subscription job"
                },
                {
                    "action":"subscription-pause",
                    "uri":"/v2/job/subscription/pause",
                    "text_cn":"暂停订阅任务",
                    "text_en":"pause subscription job"
                },
                {
                    "action":"subscription-resume",
                    "uri":"/v2/job/subscription/resume",
                    "text_cn":"重启订阅任务",
                    "text_en":"resume subscription job"
                },
                {
                    "action":"subscription-delete",
                    "uri":"/v2/job/subscription/delete",
                    "text_cn":"销毁订阅任务",
                    "text_en":"delete subscription job"
                },
                {
                    "action":"subscription-update",
                    "uri":"/v2/job/subscription/update",
                    "text_cn":"修改订阅任务",
                    "text_en":"update subscription job"
                },
                {
                    "action":"subscription-detail",
                    "uri":"/v2/job/subscription/detail",
                    "text_cn":"查看订阅任务详情",
                    "text_en":"subscription job detail"
                }
            ],
            "admin_only":false
        },
        {
            "name":"platform",
            "text_cn":"平台管理",
            "text_en":"platform",
            "menu_level":1,
            "menu_url":"",
            "id":5,
            "parent_id":0,
            "operations":[

            ],
            "admin_only":false
        },
        {
            "name":"node",
            "text_cn":"DTLE节点",
            "text_en":"dtle nodes",
            "menu_level":2,
            "menu_url":"/node",
            "id":6,
            "parent_id":5,
            "operations":[
                {
                    "action":"node-list",
                    "uri":"/v2/nodes",
                    "text_cn":"获取节点列表",
                    "text_en":"get node list"
                }
            ],
            "admin_only":false
        },
        {
            "name":"users",
            "text_cn":"用户管理",
            "text_en":"user manage",
            "menu_level":2,
            "menu_url":"/users",
            "id":7,
            "parent_id":5,
            "operations":[
                {
                    "action":"user-list",
                    "uri":"/v2/user/list",
                    "text_cn":"查看用户列表",
                    "text_en":"user list"
                },
                {
                    "action":"user-list_tenant",
                    "uri":"/v2/tenant/list",
                    "text_cn":"获取租户列表",
                    "text_en":"get tenants"
                },
                {
                    "action":"user-create",
                    "uri":"/v2/user/create",
                    "text_cn":"创建用户",
                    "text_en":"create user"
                },
                {
                    "action":"user-delete",
                    "uri":"/v2/user/delete",
                    "text_cn":"删除用户",
                    "text_en":"delete"
                },
                {
                    "action":"user-update",
                    "uri":"/v2/user/update",
                    "text_cn":"修改用户",
                    "text_en":"update user"
                }
            ],
            "admin_only":true
        },
        {
            "name":"auth",
            "text_cn":"权限配置",
            "text_en":"rights profile",
            "menu_level":2,
            "menu_url":"/auth",
            "id":8,
            "parent_id":5,
            "operations":[
                {
                    "action":"auth-list",
                    "uri":"/v2/role/list",
                    "text_cn":"查看角色列表",
                    "text_en":"role list"
                },
                {
                    "action":"auth-create",
                    "uri":"/v2/role/create",
                    "text_cn":"创建角色",
                    "text_en":"create"
                },
                {
                    "action":"auth-delete",
                    "uri":"/v2/role/delete",
                    "text_cn":"删除角色",
                    "text_en":"delete"
                },
                {
                    "action":"auth-update",
                    "uri":"/v2/role/update",
                    "text_cn":"修改角色",
                    "text_en":"update"
                }
            ],
            "admin_only":true
        }
    ],
    "message":"ok"
}
```

## 角色列表

#### API: `GET /v2/role/list`  

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明                                                                                                                                                                                                                                               |
| -------------       | ------------- | ------------- | ------------- | -------------       
| filter_tenant     | 否             | String       | ""        | 过滤器，根据租户名过滤请求结果

#### 响应参数说明

| 参数名         | 类型        | 说明                                                                                                                                                                                                                                               |
| ------------- | ------------- | -------------                                                                                                                                                                                                                                 |
| role_list.name    | String      | 角色名
| role_list.tenant    | String      | 租户名
| role_list.authority    | String      |  租户拥有的菜单/按钮权限
| role_list.object_users    | String      | 当前角色可操作对象(用户和用户创建的job)
| role_list.object_type    | String      | 所有对象都可操作(all),仅可操作自身(self),指定操作对象（designate）

#### 样例
params：  
```filter_tenant```: ""

response:
```
{
    "role_list":[
        {
            "tenant":"platform",
            "name":"admin",
            "object_users":null,
            "object_type":"all",
            "authority":"[{\"name\":\"service\",\"text_cn\":\"服务\",\"text_en\":\"service\",\"menu_level\":1,\"menu_url\":\"\",\"id\":1,\"parent_id\":0,\"operations\":[]},{\"name\":\"migration\",\"text_cn\":\"数据迁移\",\"text_en\":\"migration\",\"menu_level\":2,\"menu_url\":\"/migration\",\"id\":2,\"parent_id\":1,\"operations\":[{\"action\":\"migration-list\",\"uri\":\"/v2/jobs/migration\",\"text_cn\":\"迁移任务列表\",\"text_en\":\"migration job list\"},{\"action\":\"migration-create\",\"uri\":\"/v2/job/migration/create\",\"text_cn\":\"迁移创建任务\",\"text_en\":\"create migration job\"},{\"action\":\"migration-pause\",\"uri\":\"/v2/job/migration/pause\",\"text_cn\":\"暂停任务\",\"text_en\":\"pause migration job\"},{\"action\":\"migration-resume\",\"uri\":\"/v2/job/migration/resume\",\"text_cn\":\"重启迁移任务\",\"text_en\":\"resume migration job\"},{\"action\":\"migration-delete\",\"uri\":\"/v2/job/migration/delete\",\"text_cn\":\"销毁迁移任务\",\"text_en\":\"delete migration job\"},{\"action\":\"migration-reverse\",\"uri\":\"/v2/job/migration/reverse\",\"text_cn\":\"创建迁移反向复制任务\",\"text_en\":\"reverse migration job\"},{\"action\":\"migration-reverse_start\",\"uri\":\"/v2/job/migration/reverse_start\",\"text_cn\":\"启动迁移反向任务\",\"text_en\":\"start migration reverse job \"},{\"action\":\"migration-update\",\"uri\":\"/v2/job/migration/update\",\"text_cn\":\"修改迁移任务\",\"text_en\":\"update migration job\"},{\"action\":\"migration-detail\",\"uri\":\"/v2/job/migration/detail\",\"text_cn\":\"查看迁移任务详情\",\"text_en\":\"migration detail job\"}]},{\"name\":\"sync\",\"text_cn\":\"数据同步\",\"text_en\":\"sync\",\"menu_level\":2,\"menu_url\":\"/sync\",\"id\":3,\"parent_id\":1,\"operations\":[{\"action\":\"sync-list\",\"uri\":\"/v2/jobs/sync\",\"text_cn\":\"同步任务列表\",\"text_en\":\"sync job list\"},{\"action\":\"sync-create\",\"uri\":\"/v2/job/sync/create\",\"text_cn\":\"创建同步任务\",\"text_en\":\"create sync job\"},{\"action\":\"sync-pause\",\"uri\":\"/v2/job/sync/pause\",\"text_cn\":\"暂停同步任务\",\"text_en\":\"pause sync job\"},{\"action\":\"sync-resume\",\"uri\":\"/v2/job/sync/resume\",\"text_cn\":\"重启同步任务\",\"text_en\":\"resume sync job\"},{\"action\":\"sync-delete\",\"uri\":\"/v2/job/sync/delete\",\"text_cn\":\"销毁同步任务\",\"text_en\":\"delete sync job\"},{\"action\":\"sync-reverse\",\"uri\":\"/v2/job/sync/reverse\",\"text_cn\":\"反向复制同步任务\",\"text_en\":\"reverse sync job\"},{\"action\":\"sync-reverse_start\",\"uri\":\"/v2/job/sync/reverse_start\",\"text_cn\":\"启动同步反向任务\",\"text_en\":\"reverse start sync job\"},{\"action\":\"sync-update\",\"uri\":\"/v2/job/sync/update\",\"text_cn\":\"修改同步任务\",\"text_en\":\"update sync job\"},{\"action\":\"sync-detail\",\"uri\":\"/v2/job/sync/detail\",\"text_cn\":\"查看同步任务详情\",\"text_en\":\"sync job detail \"}]},{\"name\":\"subscription\",\"text_cn\":\"数据订阅\",\"text_en\":\"subscription\",\"menu_level\":2,\"menu_url\":\"/subscribe\",\"id\":4,\"parent_id\":1,\"operations\":[{\"action\":\"subscription-list\",\"uri\":\"/v2/jobs/subscription\",\"text_cn\":\"订阅任务列表\",\"text_en\":\"subscription job list\"},{\"action\":\"subscription-create\",\"uri\":\"/v2/job/subscription/create\",\"text_cn\":\"创建订阅任务\",\"text_en\":\"create subscription job\"},{\"action\":\"subscription-pause\",\"uri\":\"/v2/job/subscription/pause\",\"text_cn\":\"暂停订阅任务\",\"text_en\":\"pause subscription job\"},{\"action\":\"subscription-resume\",\"uri\":\"/v2/job/subscription/resume\",\"text_cn\":\"重启订阅任务\",\"text_en\":\"resume subscription job\"},{\"action\":\"subscription-delete\",\"uri\":\"/v2/job/subscription/delete\",\"text_cn\":\"销毁订阅任务\",\"text_en\":\"delete subscription job\"},{\"action\":\"subscription-update\",\"uri\":\"/v2/job/subscription/update\",\"text_cn\":\"修改订阅任务\",\"text_en\":\"update subscription job\"},{\"action\":\"subscription-detail\",\"uri\":\"/v2/job/subscription/detail\",\"text_cn\":\"查看订阅任务详情\",\"text_en\":\"subscription job detail\"}]},{\"name\":\"platform\",\"text_cn\":\"平台管理\",\"text_en\":\"platform\",\"menu_level\":1,\"menu_url\":\"\",\"id\":5,\"parent_id\":0,\"operations\":[]},{\"name\":\"node\",\"text_cn\":\"DTLE节点\",\"text_en\":\"dtle nodes\",\"menu_level\":2,\"menu_url\":\"/node\",\"id\":6,\"parent_id\":5,\"operations\":[{\"action\":\"node-list\",\"uri\":\"/v2/nodes\",\"text_cn\":\"获取节点列表\",\"text_en\":\"get node list\"}]},{\"name\":\"users\",\"admin_only\":true,\"text_cn\":\"用户管理\",\"text_en\":\"user manage\",\"menu_level\":2,\"menu_url\":\"/users\",\"id\":7,\"parent_id\":5,\"operations\":[{\"action\":\"user-list\",\"uri\":\"/v2/user/list\",\"text_cn\":\"查看用户列表\",\"text_en\":\"user list\"},{\"action\":\"user-list_tenant\",\"uri\":\"/v2/tenant/list\",\"text_cn\":\"获取租户列表\",\"text_en\":\"get tenants\"},{\"action\":\"user-create\",\"uri\":\"/v2/user/create\",\"text_cn\":\"创建用户\",\"text_en\":\"create user\"},{\"action\":\"user-delete\",\"uri\":\"/v2/user/delete\",\"text_cn\":\"删除用户\",\"text_en\":\"delete\"},{\"action\":\"user-update\",\"uri\":\"/v2/user/update\",\"text_cn\":\"修改用户\",\"text_en\":\"update user\"}]},{\"name\":\"auth\",\"admin_only\":true,\"text_cn\":\"权限配置\",\"text_en\":\"rights profile\",\"menu_level\":2,\"menu_url\":\"/auth\",\"id\":8,\"parent_id\":5,\"operations\":[{\"action\":\"auth-list\",\"uri\":\"/v2/role/list\",\"text_cn\":\"查看角色列表\",\"text_en\":\"role list\"},{\"action\":\"auth-create\",\"uri\":\"/v2/role/create\",\"text_cn\":\"创建角色\",\"text_en\":\"create\"},{\"action\":\"auth-delete\",\"uri\":\"/v2/role/delete\",\"text_cn\":\"删除角色\",\"text_en\":\"delete\"},{\"action\":\"auth-update\",\"uri\":\"/v2/role/update\",\"text_cn\":\"修改角色\",\"text_en\":\"update\"}]}]"
        }
    ],
    "message":"ok"
}
```

## 创建新角色

#### API: `POST /v2/user/create`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| name  | 是             | String       | ""        | 角色名/  
| tenant  | 是             | String       | ""        | 租户名|  
| object_users  | 是             | String       | ""        | 当前角色可操作对象(用户和用户创建的job) |  
| authority  | true             | String       | ""        | 租户拥有的菜单/按钮权限 |  
| object_type  | 是             | String       | ""        | 所有对象都可操作(all),仅可操作自身(self),指定操作对象（designate）|  

#### 响应参数说明

返回创建结果

#### 样例
params：  
```
{
    "tenant":"platform",
    "name":"user",
    "operation_object_type":"designate",
    "operation_users":[
        "platform:admin"
    ],
    "authority":"[{\"name\":\"service\",\"text_cn\":\"服务\",\"text_en\":\"service\",\"menu_level\":1,\"menu_url\":\"\",\"id\":1,\"parent_id\":0,\"operations\":[],\"admin_only\":false},{\"name\":\"platform\",\"text_cn\":\"平台管理\",\"text_en\":\"platform\",\"menu_level\":1,\"menu_url\":\"\",\"id\":5,\"parent_id\":0,\"operations\":[],\"admin_only\":false},{\"name\":\"node\",\"text_cn\":\"DTLE节点\",\"text_en\":\"dtle nodes\",\"menu_level\":2,\"menu_url\":\"/node\",\"id\":6,\"parent_id\":5,\"operations\":[{\"action\":\"node-list\",\"uri\":\"/v2/nodes\",\"text_cn\":\"获取节点列表\",\"text_en\":\"get node list\"}],\"admin_only\":false}]"
}
```

response:
```
{
    "message":"ok"
}
```

## 删除角色

#### API: `POST /v2/role/delete`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| name  | 是             | String       | ""        | 角色名/  
| tenant  | 是             | String       | ""        | 租户名|    

#### 响应参数说明

返回创建结果

#### 样例
params：  
```
   "tenant":"platform",
   "username":"test"
```

response:
```
{
    "message":"ok"
}
```

## 更新角色信息

#### API: `POST /v2/user/update`

#### 请求参数说明

| 参数名                 | 必填?           | 类型        | 默认值         | 说明            |
| -------------         | ------------- | ------------- | ------------- | ------------- |
| name  | 是             | String       | ""        | 用户名/  
| tenant  | 是             | String       | ""        | 租户名|  
| operation_object_type  | 是             | String       | ""        | 可操作对象类型 |  
| operation_users  | 否            | String Array      | ""        | 当可操作对象为designate，该字段为指定用户的列表 |
| authority  | 否             | string       | ""        | 菜单和按钮权限 |    

#### 响应参数说明

返回创建结果

#### 样例
params：  
```
{
    "tenant":"platform",
    "name":"user",
    "operation_object_type":"self",
    "authority":"[{\"name\":\"service\",\"text_cn\":\"服务\",\"text_en\":\"service\",\"menu_level\":1,\"menu_url\":\"\",\"id\":1,\"parent_id\":0,\"operations\":[],\"admin_only\":false},{\"name\":\"platform\",\"text_cn\":\"平台管理\",\"text_en\":\"platform\",\"menu_level\":1,\"menu_url\":\"\",\"id\":5,\"parent_id\":0,\"operations\":[],\"admin_only\":false},{\"name\":\"node\",\"text_cn\":\"DTLE节点\",\"text_en\":\"dtle nodes\",\"menu_level\":2,\"menu_url\":\"/node\",\"id\":6,\"parent_id\":5,\"operations\":[{\"action\":\"node-list\",\"uri\":\"/v2/nodes\",\"text_cn\":\"获取节点列表\",\"text_en\":\"get node list\"}],\"admin_only\":false},{\"name\":\"sync\",\"text_cn\":\"数据同步\",\"text_en\":\"sync\",\"menu_level\":2,\"menu_url\":\"/sync\",\"id\":3,\"parent_id\":1,\"operations\":[{\"action\":\"sync-list\",\"uri\":\"/v2/jobs/sync\",\"text_cn\":\"同步任务列表\",\"text_en\":\"sync job list\"},{\"action\":\"sync-create\",\"uri\":\"/v2/job/sync/create\",\"text_cn\":\"创建同步任务\",\"text_en\":\"create sync job\"},{\"action\":\"sync-pause\",\"uri\":\"/v2/job/sync/pause\",\"text_cn\":\"暂停同步任务\",\"text_en\":\"pause sync job\"},{\"action\":\"sync-resume\",\"uri\":\"/v2/job/sync/resume\",\"text_cn\":\"重启同步任务\",\"text_en\":\"resume sync job\"},{\"action\":\"sync-delete\",\"uri\":\"/v2/job/sync/delete\",\"text_cn\":\"销毁同步任务\",\"text_en\":\"delete sync job\"},{\"action\":\"sync-reverse\",\"uri\":\"/v2/job/sync/reverse\",\"text_cn\":\"反向复制同步任务\",\"text_en\":\"reverse sync job\"},{\"action\":\"sync-reverse_start\",\"uri\":\"/v2/job/sync/reverse_start\",\"text_cn\":\"启动同步反向任务\",\"text_en\":\"reverse start sync job\"},{\"action\":\"sync-update\",\"uri\":\"/v2/job/sync/update\",\"text_cn\":\"修改同步任务\",\"text_en\":\"update sync job\"},{\"action\":\"sync-detail\",\"uri\":\"/v2/job/sync/detail\",\"text_cn\":\"查看同步任务详情\",\"text_en\":\"sync job detail \"}],\"admin_only\":false}]"
}
```

response:
```
{
    "message":"ok"
}
```